tinymce.PluginManager.add("footnotes",function(n){function t(n,t){var e=n;for(var o in t)e=e.replace("{"+o+"}",t[o]);return e}function e(){var e=n.selection.getNode(),o="",i="SUP"==e.tagName&&"fnote"===n.dom.getAttrib(e,"class"),a="fnote"==e.className?e.nodeValue.replace(/[^0-9]/g,""):e;i&&(o=e.name||decodeURIComponent(e.getAttribute("data-content"))||""),n.windowManager.open({title:"Insert content",id:"footnote-dialog",body:[{type:"textbox",name:"name",multiline:!0,minWidth:520,minHeight:100,value:o},{type:"button",name:"link",text:"Insert link",onclick:function(n){var t=jQuery(".mce-multiline").attr("id");return wpActiveEditor=!0,wpLink.open(t),!1}}],onSubmit:function(e){var o,i=e.data.name,c='<sup class="fnote" id="#wk_ft{FN}" contenteditable="false" data-tippy-content="'+encodeURIComponent(i)+'">{FN}</button></sup>',r=n.getDoc().querySelectorAll(".fnote"),l=r.length;var s=function(n){function t(n){return n.nextAll().find(".fnote").length>0?n.next().hasClass("fnote")?n.next().children().children():n.nextAll().find(".fnote"):"BODY"==n.prop("nodeName")?[]:t(n.parent())}function e(n,t){if(!t)return!1;if(t)return t;var o=null;return t.children().each(function(){t&&(o=e(n,$(this)))}),o}return function(n,o){for(var i=t(o);0!==i.length;){var a=e(n,i);if(null!==a)return a;i=t(i)}return i}(".fnote",n)}($(n.selection.getRng().endContainer));if(s.length){var d;for(s=s[0],d=0;d<l&&s!=r[d];d++);a<l?o=t(c,{FN:$(r[a-1]).html()}):(o=t(c,{FN:$(r[d]).html()}),n.selection.collapse(0))}else o=t(c,{FN:l+1}),n.selection.collapse(0);n.execCommand("mceInsertContent",!1,o),$(n.getDoc()).find(".fnote").each(function(n){$(this).text(n+1),$(this).attr("id","#wk_ft"+(n+1))})}})}n.addCommand("mceFootnotes",e),n.addButton("footnotes",{title:"footnote",icon:"is-dashicon dashicons dashicons-admin-comments",onPostRender:function(){jQuery(".is-dashicon").css("font-family","dashicons")},onclick:e,stateSelector:"sup.fnote"})});